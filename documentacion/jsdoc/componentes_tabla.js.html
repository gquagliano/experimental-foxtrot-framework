<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: componentes/tabla.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: componentes/tabla.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright, 2020, Gabriel Quagliano. Bajo licencia Apache 2.0.
 * 
 * @author Gabriel Quagliano - gabriel.quagliano@gmail.com
 * @version 1.0
 */

 "use strict";

/**
 * @class Componente concreto Tabla de datos.
 */
var componenteTabla=function() {    
    this.componente="tabla";

    /**
     * Propiedades de Tabla.
     */
    this.propiedadesConcretas={
        "Tabla":{
            ocultarContenidos:{
                etiqueta:"Ocultar contenido",
                tipo:"bool",
                ayuda:"Si la tabla va a ser utilizada con un origen de datos, activar esta opción evitará que se muestren sus filas hasta que el contenido haya sido asignado.",
                adaptativa:false
            },
            vacia:{
                etiqueta:"Mensaje de tabla vacía",
                ayuda:"Cuando se asigne un origen de datos vacío, se mostrará este mensaje.",
                adaptativa:false
            }
        }
    };

    /**
     * Inicializa la instancia tras ser creada o restaurada.
     */
    this.inicializar=function() {
        if(this.fueInicializado) return this;

        this.contenedor=this.elemento.querySelector("tbody");

        this.inicializarComponente();
        return this;
    };

    /**
     * Crea el elemento del DOM para esta instancia (método para sobreescribir).
     */
    this.crear=function() {
        this.elemento=document.crear("&lt;div>&lt;div class='table-responsive'>&lt;table class='table table-striped table-hover' cellspacing='0'>&lt;tbody/>&lt;/table>&lt;/div>&lt;/div>"); 
        this.crearComponente();
        return this;
    };    
    
    /**
     * Actualiza el componente tras la modificación de una propiedad.
     */
    this.propiedadModificada=function(propiedad,valor,tamano,valorAnterior) {
        if(propiedad=="ocultarContenidos") {
            if(valor) {
                this.elemento.agregarClase("ocultar-contenidos");
            } else {
                this.elemento.removerClase("ocultar-contenidos");
            }
            return this;
        }

        this.propiedadModificadaComponente(propiedad,valor,tamano,valorAnterior);
        return this;
    };
    
    /**
     * Establece el origen de datos. El mismo será aplicado a toda la descendencia en forma recursiva.
     * @param {Object} obj - Objeto a asignar.
     * @param {boolean} [actualizar=true] - Actualizar el componente luego de establecer el origen de datos.
     * @returns Componente
     */
    this.establecerDatos=function(obj,actualizar) {        
        if(typeof actualizar==="undefined") actualizar=true;

        this.datos=obj;

        if(actualizar) this.actualizar();

        //No incovamos establecerDatosComponente ya que no queremos que el objeto se distribuya a la descendencia
        return this;        
    };

    /**
     * Actualiza el componente.
     * @returns {Componente}
     */
    this.actualizar=function() {
        //Limpiar filas autogeneradas
        this.elemento.querySelectorAll(".autogenerado").remover();

        if(!this.datos) return this;

        //Vamos a ocultar toda la descendencia para que las instancias originales de los campos que se van a duplicar no se vean afectadas al obtener/establecer los valores de la vista
        this.ocultarDescendencia();

        this.generarEncabezados();

        if(!this.datos.length) {
            this.mostrarMensajeSinDatos();
        } else {
            this.generarFilas();
        }

        return this;
    };

    /**
     * Genera la fila con el mensaje de tabla sin datos.
     * @returns {Componente}
     */
    this.mostrarMensajeSinDatos=function() {
        var texto=this.propiedad(null,"vacia");
        if(!texto) return this;

        var cantidadColumnas=this.elemento.querySelectorAll("thead th").length,
            tr=document.crear("tr")
                .agregarClase("autogenerado fila-sin-datos")
                .establecerHtml("&lt;td colspan='"+cantidadColumnas+"'>"+texto+"&lt;/td>");

        this.contenedor.anexar(tr);

        return this;
    };

    /**
     * Devuelve los componentes fila que no sean autogenerados.
     * @returns {Componente[]}
     */
    this.buscarFilas=function() {
        var hijos=this.obtenerHijos(),
            filas=[];

        for(var i=0;i&lt;hijos.length;i++) {
            if(!hijos[i].autogenerado) filas.push(hijos[i]);
        }
        
        return filas;
    };

    /**
     * Genera el encabezado de la tabla
     * @returns {Componente}
     */
    this.generarEncabezados=function() {
        var filas=this.buscarFilas(),
            fila=null;
        
        //Solo se considera la primer fila que no sea autogenerada en los encabezados
        if(filas.length) fila=filas[0];
        if(!fila) return this;

        var columnas=fila.obtenerHijos(); 
        if(!columnas.length) return this;
        
        var thead=document.crear("thead"),
            tr=document.crear("tr");
        thead.agregarClase("autogenerado")
            .anexar(tr);
        
        columnas.forEach(function(columna) {
            tr.anexar(columna.generarTh());
        });

        //this.contenedor es el tbody
        this.elemento.querySelector("table").anexar(thead);

        return this;
    };

    /**
     * Genera las filas de la tabla
     * @returns {Componente}
     */
    this.generarFilas=function() {
        var t=this,
            filas=this.buscarFilas();

        this.datos.forEach(function(obj,indice) {
            //Puede existir más de una fila como plantilla
            filas.forEach(function(fila) {
                fila.generarFila(t,obj,indice);
            });
        });

        return this;
    };

    /**
     * Devuelve o establece el valor del componente.
     * @param {*} [valor] - Valor a establecer
     * @returns {*}
     */
    this.valor=function(valor) {
        if(typeof valor==="undefined") {
            //Cuando se solicite el valor del componente, devolver el origen de datos actualizado con las propiedades que puedan haber cambiado
            return this.obtenerDatosActualizados();            
        } else {
            //Cuando se asigne un valor, establecer como origen de datos
            this.establecerDatos(valor);
        }
    };

    /**
     * Obtiene una copia del origen de datos actualizado con las propiedades que hayan cambiado por tratarse de componentes de ingreso de datos (campos, etc.)
     * @returns {(Object[])}
     */
    this.obtenerDatosActualizados=function() {
        var resultado=this.datos?this.datos.clonar():[];

        var fn=function(comp,indice) {
            comp.obtenerHijos().forEach(function(hijo) {
                var propiedad=hijo.propiedad(null,"propiedad"),
                    valor=hijo.valor();
                if(propiedad&amp;&amp;typeof valor!=="undefined") resultado[indice][propiedad]=valor;
                fn(hijo,indice);
            });
        };

        this.obtenerHijos().forEach(function(hijo) {
            if(!hijo.autogenerado) return;
            if(resultado.length&lt;=hijo.indice) resultado[hijo.indice]={};
            
            //Dentro de cada fila, buscar recursivamente todos los componentes relacionados con una propiedad
            fn(hijo,hijo.indice);
        });

        return resultado;
    };

    /**
     * Busca todos los componentes con nombre que desciendan de este componente y devuelve un objeto con sus valores.
     * @returns {Object}
     */
    this.obtenerValores=function() {
        return;
        //No queremos que continúe la búsqueda en forma recursiva entre los componentes autogenerados
    };

    /**
     * Agrega una nueva fila.
     * @param {*} obj - Elemento a insertar.
     * @returns {componente}
     */
    this.agregarFila=function(obj) {
        if(!util.esArray(this.datos)) this.datos=[];

        //Preservar estado actual
        this.datos=this.obtenerDatosActualizados();
        
        this.datos.push(obj);
        this.actualizar();
        return this;
    };

    /**
     * Remueve una fila dado su índice.
     * @param {number} indice - Número de fila (basado en 0).
     * @returns {componente}
     */
    this.removerFila=function(indice) {
        //Preservar estado actual
        this.datos=this.obtenerDatosActualizados();

        this.datos.splice(indice,1);
        this.actualizar();
        return this;
    };
};

ui.registrarComponente("tabla",componenteTabla,configComponente.clonar({
    descripcion:"Tabla",
    etiqueta:"Tabla",
    grupo:"Tablas de datos",
    icono:"tabla.png",
    aceptaHijos:["tabla-fila"]
}));</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Externals</h3><ul><li><a href="external-EventTarget.html">EventTarget</a></li><li><a href="external-HTMLDocument.html">HTMLDocument</a></li><li><a href="external-Node.html">Node</a></li><li><a href="external-NodeList.html">NodeList</a></li><li><a href="external-Object.html">Object</a></li><li><a href="external-Window.html">Window</a></li></ul><h3>Classes</h3><ul><li><a href="ajax.html">ajax</a></li><li><a href="aplicacion.html">aplicacion</a></li><li><a href="componente.html">componente</a></li><li><a href="componenteAgenda.html">componenteAgenda</a></li><li><a href="componenteAlternar.html">componenteAlternar</a></li><li><a href="componenteArbol.html">componenteArbol</a></li><li><a href="componenteArchivo.html">componenteArchivo</a></li><li><a href="componenteBoton.html">componenteBoton</a></li><li><a href="componenteBucle.html">componenteBucle</a></li><li><a href="componenteBuscador.html">componenteBuscador</a></li><li><a href="componenteCampo.html">componenteCampo</a></li><li><a href="componenteCheckbox.html">componenteCheckbox</a></li><li><a href="componenteCodigo.html">componenteCodigo</a></li><li><a href="componenteColumna.html">componenteColumna</a></li><li><a href="componenteColumnaTabla.html">componenteColumnaTabla</a></li><li><a href="componenteCondicional.html">componenteCondicional</a></li><li><a href="componenteContenedor.html">componenteContenedor</a></li><li><a href="componenteContenedorMenu.html">componenteContenedorMenu</a></li><li><a href="componenteDeslizable.html">componenteDeslizable</a></li><li><a href="componenteDesplegable.html">componenteDesplegable</a></li><li><a href="componenteDialogo.html">componenteDialogo</a></li><li><a href="componenteEspaciador.html">componenteEspaciador</a></li><li><a href="componenteEtiqueta.html">componenteEtiqueta</a></li><li><a href="componenteFecha.html">componenteFecha</a></li><li><a href="componenteFila.html">componenteFila</a></li><li><a href="componenteFilaTabla.html">componenteFilaTabla</a></li><li><a href="componenteFormulario.html">componenteFormulario</a></li><li><a href="componenteGrupoOpciones.html">componenteGrupoOpciones</a></li><li><a href="componenteHora.html">componenteHora</a></li><li><a href="componenteIcono.html">componenteIcono</a></li><li><a href="componenteImagen.html">componenteImagen</a></li><li><a href="componenteImportar.html">componenteImportar</a></li><li><a href="componenteItemMenu.html">componenteItemMenu</a></li><li><a href="componenteMenu.html">componenteMenu</a></li><li><a href="componenteNavegacion.html">componenteNavegacion</a></li><li><a href="componentePestana.html">componentePestana</a></li><li><a href="componentePestanas.html">componentePestanas</a></li><li><a href="componenteTabla.html">componenteTabla</a></li><li><a href="componenteTexto.html">componenteTexto</a></li><li><a href="componenteVista.html">componenteVista</a></li><li><a href="controlador.html">controlador</a></li><li><a href="editable.html">editable</a></li><li><a href="enrutador.html">enrutador</a></li><li><a href="enrutadorPredeterminado.html">enrutadorPredeterminado</a></li><li><a href="expresion.html">expresion</a></li><li><a href="servidor.html">servidor</a></li><li><a href="ui.html">ui</a></li><li><a href="util.html">util</a></li></ul><h3>Global</h3><ul><li><a href="global.html#componentes">componentes</a></li><li><a href="global.html#configComponente">configComponente</a></li><li><a href="global.html#controladores">controladores</a></li><li><a href="global.html#cuerpo">cuerpo</a></li><li><a href="global.html#documento">documento</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Mon Sep 14 2020 00:39:48 GMT-0300 (GMT-03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
